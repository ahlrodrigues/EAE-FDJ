<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Termo de Uso e Consentimento</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="card termo-card">
    <h2>Termo de Uso</h2>
    <div id="conteudoTermo"></div>
  
    <div class="termo-checkbox-container">
      <label for="checkboxAceite" class="termo-checkbox-label">
        <input type="checkbox" id="checkboxAceite" />
        ‚úÖ Li e concordo com os Termos de Uso e com a Pol√≠tica de Tratamento de Dados (LGPD)
      </label>
  
      <button id="btnAceitar" disabled class="btn-principal">Aceitar e Prosseguir</button>
    </div>
  </div>
  

  <!-- Carrega o parser Markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <script type="module">
    const checkbox = document.getElementById("checkboxAceite");
    const botao = document.getElementById("btnAceitar");
    const conteudoEl = document.getElementById("conteudoTermo");
  
    const idioma = localStorage.getItem("idioma") || "pt-BR";
  
    // üîÑ Carrega o conte√∫do do termo a partir do backend
    async function carregarTermoMarkdown() {
      try {
        const markdown = await window.api.lerTermoMarkdown(idioma);
        conteudoEl.innerHTML = marked.parse(markdown);
      } catch (erro) {
        console.error("Erro ao carregar termo:", erro);
        conteudoEl.textContent = "Erro ao carregar o termo.";
      }
    }
  
    // üü© Habilita o bot√£o quando o checkbox for marcado
    checkbox.addEventListener("change", () => {
      botao.disabled = !checkbox.checked;
    });
  
    // ‚úÖ Ao clicar, salva o aceite e fecha a janela
    botao.addEventListener("click", async () => {
      if (!checkbox.checked) {
        if (window.api?.exibirAviso) {
          await window.api.exibirAviso({
            tipo: "Aviso",
            mensagem: "Voc√™ precisa aceitar os termos antes de continuar."
          });
        } else {
          alert("Voc√™ precisa aceitar os termos antes de continuar.");
        }
        return;
      }
  
      try {
        // Salva no usuario.json
        await window.api.salvarAceite?.();
        console.log("‚úÖ Aceite salvo");
  
        // Envia evento para o main.js (fechar janela + atualizar tela de cadastro)
        window.api.enviarTermoAceito?.();
      } catch (erro) {
        console.error("‚ùå Erro ao salvar aceite:", erro);
        if (window.api?.exibirAviso) {
          await window.api.exibirAviso({
            tipo: "Erro",
            mensagem: "N√£o foi poss√≠vel salvar o aceite. Tente novamente."
          });
        } else {
          alert("Erro ao salvar aceite.");
        }
      }
    });
  
    carregarTermoMarkdown();
  </script>
  

</body>
</html>
